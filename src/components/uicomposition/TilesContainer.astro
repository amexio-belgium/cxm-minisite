---
import { PortableText } from "astro-portabletext";
import { defaultComponents } from "../cms-components/PortableText/helper";
import { getHrefFromLinkObject } from "../../lib/sanityHelpers";
import Button from "../uielements/Button.astro";
import type { Cta } from "../../sanity/sanity.types";

interface Props {
  headline: string | undefined;
  description: any;
  orangeSlant?: boolean;
  class?: string;
  cta?: Cta;
}

const locale = Astro.currentLocale!;
const {
  headline,
  description,
  orangeSlant = false,
  cta,
  class: className,
} = Astro.props;
---

<div
  class:list={[
    "relative inline-flex w-full flex-col items-start justify-start gap-20 bg-cover",
    className,
  ]}
>
  {
    orangeSlant ? (
      <div class="absolute -bottom-20 -right-3/4 -z-10 h-[1000px] w-[250%] bg-[url('/background/slant_orange.svg')] bg-contain bg-no-repeat sm:-right-full md:-top-20 md:w-[1240px] lg:-right-1/3" />
    ) : (
      <slot name="bg-image" />
    )
  }
  <div class="flex w-full flex-col items-start justify-start">
    {
      headline &&
        (!cta || (cta && (!cta.text || cta.text.length === 0))) &&
        headline.length > 0 && <h2 class="font-serif text-2xl">{headline}</h2>
    }
    {
      cta && cta.text && cta.text.length > 0 && (
        <div class="mb-8 flex w-full flex-col items-start justify-between gap-4 md:mb-4 md:flex-row md:items-center">
          <h2 class="font-serif text-2xl">{headline}</h2>
          <Button
            link={
              cta?.link ? getHrefFromLinkObject(cta.link, locale) : undefined
            }
            target={cta?.link?.blank ? "_blank" : undefined}
            style="primary"
            color="light"
          >
            {cta.text}
          </Button>
        </div>
      )
    }
    {
      description && (
        <div class="max-w-prose text-base font-light lg:w-9/12">
          <PortableText components={defaultComponents} value={description} />
        </div>
      )
    }
  </div>
  <div
    class="inline-flex w-full flex-col items-stretch justify-start gap-8 lg:flex-row"
  >
    <slot />
  </div>
</div>
