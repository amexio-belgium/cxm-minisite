---
import { parseHref } from "@lib/helpers";
import type { HTMLAttributes } from "astro/types";

type Props = HTMLAttributes<"a">;

const { href, class: className, ...props } = Astro.props;
---

<a
  href={parseHref(href)}
  class:list={[
    "2focus-visible:outline-2 js-skiplink sr-only bg-yellow-500 text-black underline focus:not-sr-only focus:block focus:px-4 focus:py-4 focus-visible:outline focus-visible:outline-offset-0 focus-visible:outline-yellow-500",
    className,
  ]}
  {...props}
>
  <slot />
</a>
<script>
  import setFocus from "@lib/setFocus.js";
  (function () {
    const initializeSkipLink = function (skiplink: any) {
      const targetId = skiplink.getAttribute("href").split("#").pop();
      const targetEl = document.getElementById(targetId);
      skiplink.addEventListener("click", () =>
        setFocus(targetEl, {
          onBeforeFocus() {
            targetEl!.classList.add("outline-none");
          },
          onBlur() {
            targetEl!.classList.remove("outline-none");
          },
        }),
      );
    };

    const skiplinks = document.querySelectorAll(".js-skiplink");

    [...skiplinks].forEach((skipLink) => {
      initializeSkipLink(skipLink);
    });
  })();
</script>
